<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="logo.png?v=2">
    <title>Module 23: Emergency Response Protocols - TheSafetyVerse</title>
    <style>body { visibility: hidden; opacity: 0; transition: opacity 0.3s; }</style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../auth/supabase-config.js"></script>
    <script src="../../auth/auth-guard.js"></script>
    <style>
        /* ═══════════════════════════════════════════
           CSS VARIABLES & RESET
           ═══════════════════════════════════════════ */
        :root {
            --primary: #FFD700;
            --primary-dark: #E6C200;
            --secondary: #FF8C00;
            --secondary-dark: #E67A00;
            --bg-clay: #F5E6D3;
            --bg-clay-dark: #E8D5C0;
            --bg-clay-light: #FAF0E6;
            --text-dark: #333333;
            --text-medium: #555555;
            --text-light: #777777;
            --accent-black: #1A1A1A;
            --white: #FFFFFF;
            --success: #4CAF50;
            --success-dark: #388E3C;
            --error: #E53935;
            --error-dark: #C62828;
            --info: #2196F3;
            --warning: #FF9800;
            --emergency-red: #B71C1C;
            --shadow-soft: 0 4px 15px rgba(0,0,0,0.1);
            --shadow-medium: 0 6px 25px rgba(0,0,0,0.15);
            --shadow-hard: 0 8px 30px rgba(0,0,0,0.2);
            --shadow-clay: 4px 4px 0px rgba(0,0,0,0.15), inset 0 2px 4px rgba(255,255,255,0.3);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-heading: 'Segoe UI', 'Arial Black', sans-serif;
            --font-body: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: var(--font-body);
            background-color: var(--bg-clay);
            color: var(--text-dark);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }
        /* Clay texture */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
            background-image:
                radial-gradient(circle at 20% 50%, rgba(139,90,43,0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139,90,43,0.02) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(139,90,43,0.03) 0%, transparent 50%);
        }
        /* ═══════════════════════════════════════════
           HEADER
           ═══════════════════════════════════════════ */
        .header {
            background: linear-gradient(180deg, var(--accent-black) 0%, #2A2A2A 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border-bottom: 4px solid var(--primary);
            z-index: 100;
            flex-shrink: 0;
        }
        .header-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            flex-shrink: 0;
        }
        .logo-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .logo-icon img {
            display: block;
            height: 50px;
            width: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.15);
            border-radius: 12px;
            transition: transform 0.2s ease;
        }
        .logo-text {
            font-family: var(--font-heading);
            font-size: 22px; font-weight: 900;
            color: var(--white);
            letter-spacing: -0.5px;
        }
        .logo-text em {
            color: var(--primary);
            font-style: normal;
        }
        .header-center {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .header-module-tag {
            background: rgba(255,215,0,0.15);
            color: var(--primary);
            font-size: 11px; font-weight: 800;
            padding: 3px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        .header-module-title {
            color: rgba(255,255,255,0.8);
            font-size: 14px; font-weight: 600;
        }
        .back-btn {
            display: flex; align-items: center; gap: 6px;
            text-decoration: none;
            color: rgba(255,255,255,0.7);
            font-size: 13px; font-weight: 600;
            padding: 7px 14px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .back-btn:hover {
            color: var(--white);
            background: rgba(255,255,255,0.12);
            border-color: rgba(255,255,255,0.2);
        }
        /* ═══════════════════════════════════════════
           PROGRESS BAR
           ═══════════════════════════════════════════ */
        .progress-bar {
            background: var(--accent-black);
            border-bottom: 1px solid rgba(255,215,0,0.15);
            flex-shrink: 0;
            z-index: 99;
        }
        .progress-bar-inner {
            max-width: 1400px;
            margin: 0 auto;
            padding: 8px 24px;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .progress-label {
            font-size: 12px; font-weight: 700;
            color: rgba(255,255,255,0.5);
            white-space: nowrap;
            min-width: 90px;
        }
        .progress-track {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.08);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 3px;
            transition: width 0.4s ease;
        }
        .progress-pct {
            font-size: 12px; font-weight: 700;
            color: var(--primary);
            min-width: 40px;
            text-align: right;
        }
        /* ═══════════════════════════════════════════
           MAIN CONTENT AREA
           ═══════════════════════════════════════════ */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px 100px;
        }
        /* ═══════════════════════════════════════════
           SLIDES
           ═══════════════════════════════════════════ */
        .slide {
            display: none;
            animation: slideIn 0.3s ease;
        }
        .slide.active { display: block; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Intro Card (Slide 1) */
        .intro-card {
            background: linear-gradient(135deg, #B71C1C 0%, #8B0000 100%);
            border-radius: var(--radius-xl);
            padding: 60px 50px;
            box-shadow: var(--shadow-hard);
            color: var(--white);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .intro-card::before {
            content: '';
            position: absolute;
            top: -100px; right: -100px;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }
        .intro-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        .intro-title {
            font-family: var(--font-heading);
            font-size: 48px; font-weight: 900;
            margin-bottom: 12px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
        }
        .intro-subtitle {
            font-size: 20px;
            margin-bottom: 30px;
            opacity: 0.95;
        }
        .intro-meta {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        .intro-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px; font-weight: 600;
        }
        .intro-meta-item span:first-child {
            font-size: 20px;
        }
        /* Content Card */
        .content-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 50px;
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
        }
        .slide-header {
            margin-bottom: 35px;
        }
        .slide-number {
            font-size: 11px; font-weight: 800;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
        }
        .slide-title {
            font-family: var(--font-heading);
            font-size: 36px; font-weight: 900;
            color: var(--text-dark);
            margin-bottom: 8px;
            line-height: 1.2;
        }
        .slide-subtitle {
            font-size: 17px;
            color: var(--text-medium);
        }
        .slide-content {
            font-size: 17px;
            line-height: 1.8;
            color: var(--text-dark);
        }
        .slide-content p {
            margin-bottom: 20px;
        }
        .slide-content strong {
            color: var(--emergency-red);
            font-weight: 700;
        }
        /* Katie Message */
        .katie-message {
            display: flex;
            align-items: flex-start;
            gap: 18px;
            background: linear-gradient(135deg, #FFFDE7 0%, #FFF9C4 100%);
            border-left: 5px solid var(--primary);
            padding: 24px;
            border-radius: var(--radius-md);
            margin-bottom: 35px;
            box-shadow: 0 3px 12px rgba(255,215,0,0.15);
        }
        .katie-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            object-position: center 20%;
            border: 4px solid var(--primary);
            flex-shrink: 0;
            box-shadow: var(--shadow-soft);
        }
        .katie-bubble {
            flex: 1;
        }
        .katie-name {
            font-weight: 800;
            color: var(--secondary);
            margin-bottom: 8px;
            font-size: 15px;
        }
        .katie-text {
            font-size: 16px;
            color: var(--text-dark);
            line-height: 1.7;
        }
        /* Info Boxes */
        .info-box {
            background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
            border-left: 5px solid var(--info);
            padding: 22px 24px;
            border-radius: var(--radius-md);
            margin: 28px 0;
        }
        .info-box.warning {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border-left-color: var(--warning);
        }
        .info-box.danger {
            background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%);
            border-left-color: var(--error);
        }
        .info-box.success {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border-left-color: var(--success);
        }
        .info-box-title {
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        .info-box-content {
            font-size: 15px;
            line-height: 1.7;
        }
        .info-box-content ul, .info-box-content ol {
            margin-top: 10px;
            padding-left: 20px;
        }
        .info-box-content li {
            margin-bottom: 6px;
        }
        /* Lists */
        .content-list {
            list-style: none;
            margin: 28px 0;
        }
        .content-list li {
            padding: 14px 0 14px 36px;
            position: relative;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            font-size: 16px;
        }
        .content-list li:last-child {
            border-bottom: none;
        }
        .content-list li::before {
            content: '&#x1F6A8;';
            position: absolute;
            left: 8px;
            font-size: 18px;
        }
        /* Response Grid */
        .type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin: 28px 0;
        }
        .type-card {
            background: var(--bg-clay-light);
            border: 3px solid var(--emergency-red);
            border-radius: var(--radius-md);
            padding: 24px;
        }
        .type-title {
            font-weight: 900;
            font-size: 18px;
            color: var(--emergency-red);
            margin-bottom: 12px;
            font-family: var(--font-heading);
        }
        .type-desc {
            font-size: 15px;
            color: var(--text-dark);
            line-height: 1.6;
        }
        /* Warning Grid */
        .warning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin: 28px 0;
        }
        .warning-card {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            border-left: 5px solid var(--warning);
            border-radius: var(--radius-md);
            padding: 20px;
        }
        .warning-title {
            font-weight: 800;
            font-size: 16px;
            color: var(--warning);
            margin-bottom: 8px;
        }
        .warning-desc {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.6;
        }
        /* Steps Grid */
        .steps-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 28px 0;
        }
        .step-card {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            background: var(--bg-clay-light);
            padding: 20px;
            border-radius: var(--radius-md);
            border-left: 5px solid var(--emergency-red);
        }
        .step-number {
            background: var(--emergency-red);
            color: var(--white);
            min-width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
            flex-shrink: 0;
        }
        .step-content h5 {
            font-weight: 800;
            margin-bottom: 6px;
            color: var(--text-dark);
            font-size: 16px;
        }
        .step-content p {
            font-size: 14px;
            color: var(--text-medium);
            line-height: 1.6;
            margin: 0;
        }
        /* Response Protocol Grid */
        .rhf-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 28px 0;
        }
        .rhf-card {
            background: var(--bg-clay-light);
            border: 3px solid var(--error);
            border-radius: var(--radius-md);
            padding: 26px;
            text-align: center;
            transition: var(--transition);
        }
        .rhf-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }
        .rhf-icon {
            font-size: 56px;
            margin-bottom: 14px;
        }
        .rhf-title {
            font-weight: 900;
            font-size: 22px;
            color: var(--error);
            margin-bottom: 12px;
            font-family: var(--font-heading);
        }
        .rhf-desc {
            font-size: 15px;
            color: var(--text-dark);
            line-height: 1.6;
        }
        /* ═══════════════════════════════════════════
           QUIZ STYLES
           ═══════════════════════════════════════════ */
        .quiz-question {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 28px;
            line-height: 1.5;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 24px;
        }
        .quiz-option {
            background: var(--bg-clay-light);
            border: 3px solid var(--bg-clay-dark);
            padding: 18px 24px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            font-weight: 600;
            position: relative;
        }
        .quiz-option:hover:not(.disabled) {
            background: var(--bg-clay);
            border-color: var(--primary);
            transform: translateX(6px);
        }
        .quiz-option.selected {
            background: var(--primary);
            border-color: var(--primary-dark);
            color: var(--accent-black);
        }
        .quiz-option.correct {
            background: var(--success);
            border-color: var(--success-dark);
            color: var(--white);
        }
        .quiz-option.incorrect {
            background: var(--error);
            border-color: var(--error-dark);
            color: var(--white);
        }
        .quiz-option.disabled {
            cursor: default;
        }
        .quiz-feedback {
            display: none;
            padding: 18px 22px;
            border-radius: var(--radius-md);
            font-size: 16px;
            line-height: 1.7;
            margin-top: 20px;
        }
        .quiz-feedback.show {
            display: block;
        }
        .quiz-feedback.correct-fb {
            background: #E8F5E9;
            color: #2E7D32;
            border-left: 5px solid var(--success);
        }
        .quiz-feedback.incorrect-fb {
            background: #FFEBEE;
            color: #C62828;
            border-left: 5px solid var(--error);
        }
        /* Quiz Buttons */
        .quiz-btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        /* Results Screen */
        .results-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: 60px 50px;
            box-shadow: var(--shadow-hard);
            text-align: center;
        }
        .results-icon {
            font-size: 100px;
            margin-bottom: 24px;
            animation: scaleIn 0.6s ease;
        }
        @keyframes scaleIn {
            from { transform: scale(0) rotate(-180deg); }
            to { transform: scale(1) rotate(0); }
        }
        .results-score {
            font-family: var(--font-heading);
            font-size: 72px;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }
        .results-title {
            font-family: var(--font-heading);
            font-size: 42px;
            font-weight: 900;
            color: var(--text-dark);
            margin-bottom: 16px;
        }
        .results-message {
            font-size: 19px;
            color: var(--text-medium);
            margin-bottom: 36px;
            line-height: 1.7;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .results-katie {
            background: linear-gradient(135deg, #FFFDE7 0%, #FFF9C4 100%);
            border-left: 5px solid var(--primary);
            padding: 20px 24px;
            border-radius: var(--radius-md);
            font-size: 17px;
            font-style: italic;
            color: var(--text-dark);
            margin-bottom: 36px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .results-buttons {
            display: flex;
            justify-content: center;
            gap: 14px;
            flex-wrap: wrap;
        }
        /* ═══════════════════════════════════════════
           BUTTONS
           ═══════════════════════════════════════════ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius-sm);
            font-family: var(--font-heading);
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            box-shadow: var(--shadow-clay);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-gold {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--accent-black);
        }
        .btn-gold:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hard);
        }
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        .btn-success:hover:not(:disabled) {
            background: var(--success-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-hard);
        }
        .btn-outline {
            background: var(--white);
            color: var(--text-dark);
            border: 2px solid var(--bg-clay-dark);
        }
        .btn-outline:hover:not(:disabled) {
            background: var(--bg-clay-light);
            border-color: var(--primary);
        }
        /* ═══════════════════════════════════════════
           NAVIGATION
           ═══════════════════════════════════════════ */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(26,26,26,0.97) 0%, rgba(0,0,0,0.98) 100%);
            border-top: 3px solid var(--primary);
            padding: 16px 24px;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
        }
        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: var(--radius-sm);
            font-family: var(--font-heading);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(255,255,255,0.08);
            color: var(--white);
            text-decoration: none;
        }
        .nav-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.15);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .nav-btn.nav-next {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--accent-black);
            border-color: transparent;
        }
        .nav-btn.nav-next:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,215,0,0.4);
        }
        .slide-indicator {
            color: rgba(255,255,255,0.6);
            font-size: 13px;
            font-weight: 600;
        }
        /* ═══════════════════════════════════════════
           RESPONSIVE
           ═══════════════════════════════════════════ */
        @media (max-width: 768px) {
            .container { padding: 30px 20px 100px; }
            .content-card { padding: 32px 24px; }
            .intro-card { padding: 40px 30px; }
            .intro-title { font-size: 36px; }
            .slide-title { font-size: 28px; }
            .type-grid { grid-template-columns: 1fr; }
            .warning-grid { grid-template-columns: 1fr; }
            .rhf-grid { grid-template-columns: 1fr; }
            .nav-inner { flex-direction: column; gap: 12px; }
            .nav-btn { width: 100%; justify-content: center; }
            .header-center { position: static; transform: none; }
        }
        @media (max-width: 480px) {
            .intro-meta { flex-direction: column; gap: 16px; }
            .katie-message { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <a href="../../user-dashboard/index.html" class="logo">
                <div class="logo-icon"><img src="logo.png?v=2" alt="TheSafetyVerse Logo"></div>
                <div class="logo-text"><em>The</em>Safety<em>Verse</em></div>
            </a>
            <div class="header-center">
                <span class="header-module-tag">MODULE 23</span>
                <span class="header-module-title">Emergency Response Protocols</span>
            </div>
            <a href="../../user-dashboard/index.html" class="back-btn">
                <span>&#x2190;</span>
                <span>Back to Dashboard</span>
            </a>
        </div>
    </header>
    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-bar-inner">
            <span class="progress-label" id="progressLabel">Slide 1 of 16</span>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <span class="progress-pct" id="progressPct">0%</span>
        </div>
    </div>
    <!-- Main Content -->
    <div class="content-wrapper">
        <div class="container">
            <!-- Slide 1: Intro -->
            <div class="slide active" data-slide="1">
                <div class="intro-card">
                    <div class="intro-icon">&#x1F6A8;</div>
                    <h1 class="intro-title">Emergency Response Protocols</h1>
                    <p class="intro-subtitle">Prepared. Coordinated. Effective.</p>
                    <div class="intro-meta">
                        <div class="intro-meta-item">
                            <span>&#x23F1;</span>
                            <span>20 minutes</span>
                        </div>
                        <div class="intro-meta-item">
                            <span>&#x1F4DA;</span>
                            <span>Security & Threat Response Path</span>
                        </div>
                        <div class="intro-meta-item">
                            <span>&#x2713;</span>
                            <span>OSHA/NIMS Aligned</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 2: Introduction with Katie -->
            <div class="slide" data-slide="2">
                <div class="content-card">
                    <div class="katie-message">
                        <img src="katie.png" alt="Katie" class="katie-avatar">
                        <div class="katie-bubble">
                            <div class="katie-name">Katie, Your Safety Guide</div>
                            <div class="katie-text">
                                Welcome to Emergency Response Protocols! When emergencies happen, trained response saves lives. Whether it's a medical crisis, an active threat, a fire, or a natural disaster, knowing what to do in those first critical minutes can mean the difference between chaos and coordinated action. OSHA requires employers to have emergency action plans under 29 CFR 1910.38, and as security personnel, you are often the first person on scene. Let's make sure you're ready.
                            </div>
                        </div>
                    </div>
                    <div class="slide-header">
                        <div class="slide-number">Slide 2 of 16</div>
                        <h2 class="slide-title">Why Emergency Response Training Matters</h2>
                    </div>
                    <div class="slide-content">
                        <p><strong>Emergencies are unpredictable, but your response doesn't have to be.</strong> Proper training transforms panic into purpose and confusion into coordinated action.</p>

                        <div class="info-box danger">
                            <div class="info-box-title">&#x1F6A8; The Reality of Emergency Response</div>
                            <div class="info-box-content">
                                <ul>
                                    <li><strong>The first 5 minutes</strong> of any emergency are the most critical for outcomes</li>
                                    <li><strong>Average EMS response time</strong> is 7-14 minutes depending on location</li>
                                    <li><strong>Untrained bystanders</strong> often freeze, flee without helping, or make situations worse</li>
                                    <li><strong>Trained responders</strong> reduce injury severity and save lives during the gap before professional help arrives</li>
                                    <li><strong>OSHA citations</strong> for inadequate emergency action plans are among the most common violations</li>
                                </ul>
                            </div>
                        </div>

                        <p><strong>Learning Objectives:</strong></p>
                        <ul class="content-list">
                            <li>Understand the Incident Command System (ICS) framework and your role within it</li>
                            <li>Respond effectively to active threats using lockdown, evacuation, and shelter-in-place protocols</li>
                            <li>Manage emergency scenes including perimeter, access control, and evidence preservation</li>
                            <li>Coordinate effectively with first responders during transfer of command</li>
                            <li>Execute post-incident procedures including accountability, debriefing, and documentation</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Slide 3: Emergency Response Framework -->
            <div class="slide" data-slide="3">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 3 of 16</div>
                        <h2 class="slide-title">Emergency Response Framework</h2>
                        <p class="slide-subtitle">Incident Command System (ICS) basics for security personnel</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>The Incident Command System (ICS) is the standardized management structure used by emergency responders nationwide.</strong> As security personnel, you need to understand how it works because you are often the first person on scene.</p>

                        <div class="type-grid">
                            <div class="type-card">
                                <div class="type-title">&#x1F4CB; Chain of Command</div>
                                <div class="type-desc">
                                    Every person reports to one supervisor. This prevents conflicting orders and confusion. As first on scene, you may serve as the initial Incident Commander until a higher authority arrives and assumes command.
                                </div>
                            </div>
                            <div class="type-card">
                                <div class="type-title">&#x1F91D; Unified Command</div>
                                <div class="type-desc">
                                    When multiple agencies respond (police, fire, EMS), unified command allows them to work together under a shared structure. Your job: facilitate the handoff and provide them the information they need to take over.
                                </div>
                            </div>
                            <div class="type-card">
                                <div class="type-title">&#x1F465; Span of Control</div>
                                <div class="type-desc">
                                    One supervisor should manage no more than 3-7 people (ideal is 5). If you're directing a response and it grows beyond your capacity, delegate. Assign someone to manage a specific task or area so you can maintain oversight.
                                </div>
                            </div>
                            <div class="type-card">
                                <div class="type-title">&#x1F4AC; Common Terminology</div>
                                <div class="type-desc">
                                    Use plain language that everyone understands. Avoid jargon, agency-specific codes, or radio shorthand unless your entire team uses the same system. Clarity prevents deadly misunderstandings during emergencies.
                                </div>
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; NIMS: The National Incident Management System</div>
                            <div class="info-box-content">
                                ICS operates within NIMS, which provides the nationwide framework for government, private sector, and nongovernmental organizations to work together during incidents. NIMS ensures that everyone speaks the same language, follows the same structure, and can integrate seamlessly when multiple agencies respond. As security personnel, understanding NIMS means you can coordinate with any responding agency, regardless of jurisdiction.
                            </div>
                        </div>

                        <div class="info-box warning">
                            <div class="info-box-title">&#x26A0; Your Role: Initial Incident Commander</div>
                            <div class="info-box-content">
                                As the first person on scene, you are the initial Incident Commander by default. That means:<br>
                                &#8226; Assess the situation and determine the scope<br>
                                &#8226; Establish a command post (even if informal)<br>
                                &#8226; Begin directing resources and people<br>
                                &#8226; Communicate status to dispatch and management<br>
                                &#8226; Transfer command when a higher authority arrives<br><br>
                                <strong>You don't need to solve everything. You need to stabilize the situation until professional responders arrive.</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 4: Active Threat Response -->
            <div class="slide" data-slide="4">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 4 of 16</div>
                        <h2 class="slide-title">Active Threat Response</h2>
                        <p class="slide-subtitle">Choosing the right response for the situation</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>Not every emergency calls for the same response.</strong> The correct action depends on the type of threat, its location, and your proximity to it. Security personnel must know all three primary response options and when to use each.</p>

                        <div class="rhf-grid">
                            <div class="rhf-card">
                                <div class="rhf-icon">&#x1F512;</div>
                                <div class="rhf-title">LOCKDOWN</div>
                                <div class="rhf-desc">
                                    <strong>Secure in place when threat is inside or nearby.</strong><br><br>
                                    &#8226; Lock and barricade all doors<br>
                                    &#8226; Turn off lights<br>
                                    &#8226; Silence all phones completely<br>
                                    &#8226; Move away from doors and windows<br>
                                    &#8226; Stay low and quiet<br>
                                    &#8226; Do NOT open door for anyone until all-clear from authority
                                </div>
                            </div>
                            <div class="rhf-card">
                                <div class="rhf-icon">&#x1F6B6;</div>
                                <div class="rhf-title">EVACUATION</div>
                                <div class="rhf-desc">
                                    <strong>Move away from threat using predetermined routes.</strong><br><br>
                                    &#8226; Use primary evacuation route if clear<br>
                                    &#8226; Switch to alternate routes if primary is blocked<br>
                                    &#8226; Assist others who need help (mobility, injury)<br>
                                    &#8226; Leave belongings behind<br>
                                    &#8226; Move to assembly point<br>
                                    &#8226; Do NOT re-enter until all-clear is given
                                </div>
                            </div>
                            <div class="rhf-card">
                                <div class="rhf-icon">&#x1F3E0;</div>
                                <div class="rhf-title">SHELTER-IN-PLACE</div>
                                <div class="rhf-desc">
                                    <strong>For external threats: severe weather, hazmat, outside active threat.</strong><br><br>
                                    &#8226; Move to interior rooms away from windows<br>
                                    &#8226; Close and seal doors/windows (hazmat)<br>
                                    &#8226; Monitor emergency channels for updates<br>
                                    &#8226; Account for all personnel in your area<br>
                                    &#8226; Stay sheltered until hazard passes<br>
                                    &#8226; Follow specific protocols for threat type
                                </div>
                            </div>
                        </div>

                        <div class="info-box danger">
                            <div class="info-box-title">&#x1F6A8; Decision Tree: Which Response?</div>
                            <div class="info-box-content">
                                <strong>Threat is INSIDE your building, in your area:</strong> LOCKDOWN immediately. Do not attempt to evacuate past the threat.<br><br>
                                <strong>Threat is INSIDE your building, but NOT in your area:</strong> EVACUATE if you have a clear, safe route away from the threat. LOCKDOWN if evacuation would bring you closer to the threat.<br><br>
                                <strong>Threat is OUTSIDE your building:</strong> SHELTER-IN-PLACE. Secure all entry points and keep everyone inside until the external threat is resolved.<br><br>
                                <strong>Environmental hazard (tornado, hazmat spill):</strong> SHELTER-IN-PLACE in designated safe areas. Move to interior rooms, below ground level for tornados, or sealed rooms for hazmat.<br><br>
                                <strong>Fire or structural hazard:</strong> EVACUATE. Never shelter in place during a fire.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 5: Medical Emergencies -->
            <div class="slide" data-slide="5">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 5 of 16</div>
                        <h2 class="slide-title">Medical Emergencies</h2>
                        <p class="slide-subtitle">First response priorities for security personnel</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>You don't need to be a paramedic. Your job is to secure the scene, get professional help on the way, and provide basic assistance until they arrive.</strong></p>

                        <div class="steps-grid">
                            <div class="step-card">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>Scene Safety FIRST</h5>
                                    <p>Before approaching any victim, assess the scene. Is the area safe for you to enter? Are there electrical hazards, chemical spills, structural damage, or ongoing threats? A dead rescuer helps no one. If the scene is not safe, do NOT enter. Call for specialized help and wait.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Call 911 Immediately</h5>
                                    <p>Provide clear, concise information: your exact location (building, floor, room number), nature of the emergency, number of victims, any known hazards, and what assistance is already on scene. Stay on the line if possible. Dispatch may provide instructions.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Provide Basic Life Support (If Trained)</h5>
                                    <p>If you are trained in CPR and the scene is safe, begin chest compressions if the person is unresponsive and not breathing normally. Use an AED if available. If you are not CPR certified, hands-only CPR (push hard and fast on the center of the chest) is better than nothing.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5>Control Severe Bleeding</h5>
                                    <p>Apply direct pressure with a clean cloth or bandage. If bleeding is life-threatening and from a limb, apply a tourniquet if trained (STOP THE BLEED principles). Pack wounds with available material and maintain pressure. Elevate the injured limb if possible.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h5>Do Not Move the Injured (Unless Danger is Present)</h5>
                                    <p>Moving someone with a spinal injury can cause permanent paralysis. Only move a victim if they are in immediate danger (fire, structural collapse, active threat). Keep them still, warm, and reassured until EMS arrives.</p>
                                </div>
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; Your Role in Medical Emergencies</div>
                            <div class="info-box-content">
                                Remember: you are not expected to be a medic. Your primary responsibilities are to:<br>
                                &#8226; <strong>Secure the scene</strong> so it is safe for victims and responders<br>
                                &#8226; <strong>Call for help</strong> and provide accurate information<br>
                                &#8226; <strong>Guide EMS to the location</strong> when they arrive<br>
                                &#8226; <strong>Control access</strong> to keep bystanders back<br>
                                &#8226; <strong>Provide basic aid</strong> within your training level<br><br>
                                Doing these five things well can save a life even without any medical certification.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 6: Scene Management -->
            <div class="slide" data-slide="6">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 6 of 16</div>
                        <h2 class="slide-title">Scene Management</h2>
                        <p class="slide-subtitle">Securing the area and maintaining control</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>Effective scene management prevents secondary incidents, preserves evidence, and ensures first responders can do their jobs efficiently.</strong></p>

                        <div class="steps-grid">
                            <div class="step-card">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>Establish a Perimeter</h5>
                                    <p>Create a boundary around the incident area. Use cones, tape, vehicles, or personnel to define the zone. The perimeter should be large enough to protect bystanders and preserve evidence, but not so large that it disrupts all operations. Adjust as the situation evolves.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Control Access Points</h5>
                                    <p>Designate entry and exit points for the perimeter. Only authorized personnel (responders, investigators) should enter. Log who enters and exits if possible. This protects the scene and creates an accountability record.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Redirect Traffic and People</h5>
                                    <p>Move bystanders, employees, and vehicles away from the scene. Direct foot traffic around the perimeter. If the incident blocks normal building access, establish alternate routes. Keep onlookers at a safe distance without being confrontational.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5>Preserve Evidence</h5>
                                    <p>Do not touch, move, or disturb anything at the scene unless it is necessary to save a life. Do not allow others to clean up, pick up items, or alter the scene. Evidence can include physical objects, fluids, camera footage, and witness accounts. Investigators will need all of it.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h5>Set Up a Staging Area</h5>
                                    <p>Designate a location near but outside the perimeter where incoming responders can gather, receive briefings, and stage equipment. This prevents responders from arriving and adding to the confusion at the scene itself. Guide incoming units to the staging area.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">6</div>
                                <div class="step-content">
                                    <h5>Crowd Control</h5>
                                    <p>Be firm but calm with bystanders. Use clear, direct language: "Please move back to this line." "This area is restricted right now." Do not argue or explain in detail during the active response. Keep emotional bystanders away from victims and the scene.</p>
                                </div>
                            </div>
                        </div>

                        <div class="info-box warning">
                            <div class="info-box-title">&#x26A0; Common Scene Management Mistakes</div>
                            <div class="info-box-content">
                                &#8226; Perimeter too small, allowing bystanders to contaminate the scene<br>
                                &#8226; Allowing too many people through the perimeter ("I just want to look")<br>
                                &#8226; Moving or cleaning up evidence before investigators arrive<br>
                                &#8226; Forgetting to designate a staging area, leading to responder chaos<br>
                                &#8226; Getting drawn into the incident response instead of managing the scene<br><br>
                                <strong>Your job is to manage the scene. Let the specialists handle the incident.</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 7: Coordinating with First Responders -->
            <div class="slide" data-slide="7">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 7 of 16</div>
                        <h2 class="slide-title">Coordinating with First Responders</h2>
                        <p class="slide-subtitle">What they need from you and how to hand off command</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>When police, fire, or EMS arrive on scene, they need actionable information immediately.</strong> A clear, organized handoff can save critical minutes.</p>

                        <div class="info-box danger">
                            <div class="info-box-title">&#x1F6A8; The Responder Briefing: What They Need From You</div>
                            <div class="info-box-content">
                                When first responders arrive, provide a concise briefing covering:<br><br>
                                <strong>1. What happened:</strong> Type of incident, how it started, timeline of events<br><br>
                                <strong>2. How many are involved:</strong> Number of victims, suspects, bystanders, missing persons<br><br>
                                <strong>3. Weapons or hazards present:</strong> Firearms, chemical spills, structural damage, fire, electrical hazards<br><br>
                                <strong>4. Building layout:</strong> Entrances, exits, stairwells, elevators, where the incident occurred. Provide a site map if available<br><br>
                                <strong>5. Where victims are located:</strong> Specific rooms, floors, areas. Any victims still trapped or unaccounted for<br><br>
                                <strong>6. What you've done so far:</strong> Actions taken, resources deployed, notifications made, any aid provided
                            </div>
                        </div>

                        <div class="info-box success">
                            <div class="info-box-title">&#x2713; Transfer of Command</div>
                            <div class="info-box-content">
                                When a higher-ranking responder assumes command:<br><br>
                                &#8226; <strong>Provide your full briefing</strong> with all information gathered<br>
                                &#8226; <strong>Hand over any documentation</strong> (access logs, witness lists, notes)<br>
                                &#8226; <strong>Confirm the transfer verbally:</strong> "I am transferring command to you. Here is the current situation..."<br>
                                &#8226; <strong>Remain available</strong> for questions and to support their operations<br>
                                &#8226; <strong>Continue to manage your assigned tasks</strong> or accept new assignments from the incoming commander<br><br>
                                <strong>Don't take it personally when they take over. That is the system working exactly as designed.</strong> Your role shifts from commander to support. The goal is the best outcome, not personal authority.
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; Building Relationships Before Emergencies</div>
                            <div class="info-box-content">
                                The time to meet your local fire, police, and EMS personnel is BEFORE an emergency. Invite them for facility tours. Share building maps and access information. Discuss emergency plans. When the real emergency comes, you'll already know each other and work together more effectively.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 8: Emergency Communication -->
            <div class="slide" data-slide="8">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 8 of 16</div>
                        <h2 class="slide-title">Emergency Communication</h2>
                        <p class="slide-subtitle">Clear, concise, and life-saving</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>In an emergency, poor communication kills. Garbled radio calls, vague descriptions, and incomplete information cost precious time.</strong> Train yourself to communicate with precision under pressure.</p>

                        <div class="info-box danger">
                            <div class="info-box-title">&#x1F6A8; The Emergency Communication Framework</div>
                            <div class="info-box-content">
                                Every emergency communication should answer these questions:<br><br>
                                <strong>WHO</strong> is reporting (your name, position, call sign)<br>
                                <strong>WHAT</strong> is happening (type of emergency, severity)<br>
                                <strong>WHERE</strong> is it happening (building, floor, room, nearest landmark)<br>
                                <strong>WHEN</strong> did it start (time of first observation)<br>
                                <strong>HOW MANY</strong> are involved (victims, suspects, affected personnel)<br><br>
                                Example: "This is Officer Johnson, Post 3. I have a medical emergency, Building A, second floor, Room 214. One person down, not breathing. Requesting EMS immediately."
                            </div>
                        </div>

                        <div class="info-box success">
                            <div class="info-box-title">&#x2713; Communication Best Practices</div>
                            <div class="info-box-content">
                                <strong>Use plain language:</strong> No agency-specific codes unless your entire team is trained on them. "I need police" is clearer than "Code 7" to mixed teams.<br><br>
                                <strong>Speak slowly and clearly:</strong> Adrenaline makes you talk fast. Consciously slow down. If the person on the other end can't understand you, the communication failed.<br><br>
                                <strong>Provide regular status updates:</strong> Don't go silent. Update dispatch and command every few minutes, even if it's "No change, situation stable."<br><br>
                                <strong>Confirm receipt:</strong> After giving critical information, ask for confirmation: "Copy?" or "Do you have that?"<br><br>
                                <strong>Listen more than you talk:</strong> You may receive critical instructions. Keep the channel clear for incoming information.
                            </div>
                        </div>

                        <div class="info-box warning">
                            <div class="info-box-title">&#x26A0; Communication Cascade: Who Calls Who</div>
                            <div class="info-box-content">
                                Know your organization's communication chain BEFORE an emergency:<br><br>
                                &#8226; <strong>You</strong> notify dispatch / control center and 911 (if warranted)<br>
                                &#8226; <strong>Dispatch</strong> notifies management, additional security, and relevant departments<br>
                                &#8226; <strong>Management</strong> notifies executive leadership and communications/PR<br>
                                &#8226; <strong>Communications</strong> handles media, public notifications, and family notifications<br><br>
                                <strong>Know your piece of the chain. Execute it. Don't try to do everyone else's job.</strong>
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; Practice Your Emergency Call Script</div>
                            <div class="info-box-content">
                                Under extreme stress, your brain defaults to what it has practiced. If you've never practiced making an emergency call, your first attempt will be under the worst possible conditions. Practice the framework (who, what, where, when, how many) until it becomes automatic. Rehearse it during drills. Script it on a card you carry. When the real call comes, you'll deliver it clearly.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 9: Evacuation Procedures -->
            <div class="slide" data-slide="9">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 9 of 16</div>
                        <h2 class="slide-title">Evacuation Procedures</h2>
                        <p class="slide-subtitle">Getting everyone out safely and accounted for</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>A successful evacuation is one where every person reaches safety and is accounted for.</strong> Speed matters, but accountability matters more.</p>

                        <div class="steps-grid">
                            <div class="step-card">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>Assembly Points and Alternates</h5>
                                    <p>Every facility should have primary and secondary assembly points. Primary should be a safe distance from the building, away from emergency vehicle routes. The secondary is used if the primary is compromised (wind direction for hazmat, proximity to threat). Know both locations.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Accountability (Headcount)</h5>
                                    <p>At the assembly point, department supervisors or floor wardens must conduct headcounts immediately. Compare against who was in the building. Report any missing personnel to the Incident Commander at once. Missing people may still be inside and need rescue.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Special Needs Personnel Assistance</h5>
                                    <p>Identify individuals who need evacuation assistance BEFORE an emergency: wheelchair users, visually or hearing impaired, pregnant employees, anyone with mobility limitations. Assign evacuation buddies. Know where evacuation chairs are stored. Have a plan for every person.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5>Evacuation Routes and Backups</h5>
                                    <p>Primary routes should be clearly marked with illuminated exit signs. Backup routes are critical when primary routes are blocked by fire, debris, or the threat itself. Know at least two ways out of every area you work in. Stairwells are primary; elevators are NOT used during fire evacuations.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h5>Rally Point Leadership</h5>
                                    <p>Someone must be in charge at the assembly point. This person conducts the headcount, keeps people together, relays information, and prevents people from re-entering. Assign rally point leaders in advance. They need a checklist, a roster, and a communication device.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">6</div>
                                <div class="step-content">
                                    <h5>Never Re-Enter Until All-Clear</h5>
                                    <p>No matter how important your laptop, purse, or medication seems, do NOT re-enter the building until the Incident Commander or fire authority gives the official all-clear. Re-entering during an active emergency puts you and the responders looking for you at risk.</p>
                                </div>
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; Evacuation Map Awareness</div>
                            <div class="info-box-content">
                                Evacuation maps should be posted on every floor near elevators and stairwells. But maps are useless if you've never looked at them. Take 30 seconds today to study the evacuation map nearest your work area. Locate your primary exit, your alternate exit, the fire extinguishers, the pull stations, and the assembly point. That 30 seconds of preparation could save your life.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 10: Post-Emergency Procedures -->
            <div class="slide" data-slide="10">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 10 of 16</div>
                        <h2 class="slide-title">Post-Emergency Procedures</h2>
                        <p class="slide-subtitle">The emergency isn't over when the sirens stop</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>What happens after the immediate emergency is resolved is just as critical as the response itself.</strong> Post-incident procedures protect people, preserve evidence, and improve future responses.</p>

                        <div class="steps-grid">
                            <div class="step-card">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>All-Clear Protocols</h5>
                                    <p>Only the Incident Commander or designated authority issues the all-clear. It must be communicated through official channels, not word of mouth. Confirm that all areas have been searched and cleared. Do not allow re-entry until the all-clear is verified and communicated to all personnel.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Accountability Verification</h5>
                                    <p>Final headcount at assembly points. Cross-reference against building access logs, sign-in sheets, and department rosters. Confirm that all visitors, contractors, and temporary workers are accounted for. Report any discrepancies immediately.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Scene Preservation for Investigation</h5>
                                    <p>Maintain the perimeter until investigators release the scene. Do not allow cleanup, restoration, or repair until investigators have completed their work. Secure any video footage, access logs, and electronic records. These may be needed for criminal, insurance, or regulatory investigations.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h5>Initial Documentation</h5>
                                    <p>Write down everything while it is fresh: what you saw, heard, and did. Include times, names, locations, and actions taken. This documentation will be critical for incident reports, investigations, and after-action reviews. Memory fades quickly; document within the first hour.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">5</div>
                                <div class="step-content">
                                    <h5>Debriefing Process (Hot Wash)</h5>
                                    <p>Conduct an immediate "hot wash" with key responders while memories are fresh. What happened? What went well? What didn't? What do we need to change? This is not about blame. It is about learning and improving. A formal after-action report follows within days or weeks.</p>
                                </div>
                            </div>
                            <div class="step-card">
                                <div class="step-number">6</div>
                                <div class="step-content">
                                    <h5>Mental Health Check-Ins</h5>
                                    <p>Emergencies affect everyone, including responders. Check on your team and yourself. Offer access to Employee Assistance Programs (EAP), counseling, or peer support. Watch for signs of acute stress, PTSD, sleep disruption, or withdrawal in the days and weeks that follow. It is not weakness to need help after a traumatic event.</p>
                                </div>
                            </div>
                        </div>

                        <div class="info-box warning">
                            <div class="info-box-title">&#x26A0; Don't Skip Post-Incident Steps</div>
                            <div class="info-box-content">
                                The adrenaline fades and everyone wants to "get back to normal." Resist that urge. Skipping post-emergency procedures means:<br>
                                &#8226; Evidence gets lost or contaminated<br>
                                &#8226; Lessons are never captured<br>
                                &#8226; The same mistakes happen next time<br>
                                &#8226; People who need help don't get it<br><br>
                                <strong>The emergency is not over until the paperwork is done, the debrief is complete, and your people are okay.</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 11: Drills & Preparedness -->
            <div class="slide" data-slide="11">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 11 of 16</div>
                        <h2 class="slide-title">Drills & Preparedness</h2>
                        <p class="slide-subtitle">Building muscle memory before you need it</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>You don't rise to the level of your expectations in an emergency. You fall to the level of your training.</strong> Regular drills are the only way to build the reflexes that will carry you through a real crisis.</p>

                        <div class="type-grid">
                            <div class="type-card">
                                <div class="type-title">&#x1F4DD; Tabletop Exercises</div>
                                <div class="type-desc">
                                    Discussion-based exercises where participants walk through a scenario verbally. Low cost, low disruption, high learning value. Great for testing decision-making, communication plans, and identifying gaps. Conducted in a meeting room with key personnel.
                                </div>
                            </div>
                            <div class="type-card">
                                <div class="type-title">&#x2699; Functional Exercises</div>
                                <div class="type-desc">
                                    Simulate specific functions of the emergency plan: communications, evacuation of one floor, lockdown of a wing. Tests real systems without a full-scale mobilization. Identifies equipment failures, timing issues, and procedural gaps in specific areas.
                                </div>
                            </div>
                            <div class="type-card">
                                <div class="type-title">&#x1F3AF; Full-Scale Exercises</div>
                                <div class="type-desc">
                                    Complete, realistic simulation involving all personnel, responders, and systems. Tests the entire emergency plan from activation to all-clear. Most expensive and disruptive, but most revealing. Often involves local emergency services. Conducted annually or as required by regulation.
                                </div>
                            </div>
                        </div>

                        <div class="info-box success">
                            <div class="info-box-title">&#x2713; After-Action Reviews: The Key to Improvement</div>
                            <div class="info-box-content">
                                Every drill should produce an after-action report that answers:<br><br>
                                &#8226; <strong>What was supposed to happen?</strong> (The plan)<br>
                                &#8226; <strong>What actually happened?</strong> (Reality)<br>
                                &#8226; <strong>What went well?</strong> (Sustain these)<br>
                                &#8226; <strong>What needs improvement?</strong> (Action items with owners and deadlines)<br><br>
                                Update your emergency plans based on drill findings. A plan that has never been tested is just a theory. A plan that has been tested and updated is a lifeline.
                            </div>
                        </div>

                        <div class="info-box">
                            <div class="info-box-title">&#x1F4A1; Personal Readiness Checklist</div>
                            <div class="info-box-content">
                                Right now, can you answer these questions?<br><br>
                                &#8226; What is YOUR role in the emergency plan?<br>
                                &#8226; Where are YOUR nearest two exits?<br>
                                &#8226; Where is YOUR assembly point?<br>
                                &#8226; Where is the nearest fire extinguisher to YOUR work area?<br>
                                &#8226; Where is the nearest AED?<br>
                                &#8226; Do you have YOUR emergency contact information updated?<br>
                                &#8226; Is YOUR phone charged?<br><br>
                                If you can't answer all of these, fix that today. Personal readiness is the foundation of organizational readiness.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 12: Key Takeaways -->
            <div class="slide" data-slide="12">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Slide 12 of 16</div>
                        <h2 class="slide-title">Key Takeaways</h2>
                        <p class="slide-subtitle">Your emergency response quick reference</p>
                    </div>
                    <div class="slide-content">
                        <p><strong>Essential emergency response knowledge to carry with you:</strong></p>
                        <ul class="content-list">
                            <li><strong>ICS gives you structure:</strong> Chain of command, unified command, span of control, common terminology. As first on scene, you are the initial Incident Commander until relief arrives.</li>
                            <li><strong>Match your response to the threat:</strong> Lockdown for internal threats, evacuation when you have a clear path away, shelter-in-place for external hazards. The wrong response can put people in more danger.</li>
                            <li><strong>Medical emergencies: scene safety first:</strong> Secure the scene, call 911, provide location and details, give basic aid within your training level, and don't move the injured unless danger is present.</li>
                            <li><strong>Manage the scene, not just the incident:</strong> Establish perimeter, control access, redirect people, preserve evidence, set up staging area. Let specialists handle the incident itself.</li>
                            <li><strong>Give responders what they need:</strong> What happened, how many involved, hazards present, building layout, where victims are, what you've done so far. Clear handoff saves critical minutes.</li>
                            <li><strong>Communicate with precision:</strong> Who, what, where, when, how many. Plain language. Regular updates. Practice your emergency call script until it's automatic.</li>
                            <li><strong>Evacuations require accountability:</strong> Assembly points, headcounts, special needs assistance, rally point leadership. Never re-enter until the all-clear is given by authority.</li>
                            <li><strong>Post-emergency matters:</strong> All-clear verification, scene preservation, documentation, hot wash debriefing, and mental health check-ins. The emergency isn't over when the sirens stop.</li>
                            <li><strong>Drills build muscle memory:</strong> Tabletop, functional, and full-scale exercises. After-action reviews drive improvement. A plan that has never been tested is just a theory.</li>
                        </ul>

                        <div class="info-box danger">
                            <div class="info-box-title">&#x1F6A8; Emergency Communication Template</div>
                            <div class="info-box-content">
                                "This is <strong>[YOUR NAME/POSITION]</strong>. I have a <strong>[TYPE OF EMERGENCY]</strong> at <strong>[EXACT LOCATION]</strong>. There are <strong>[NUMBER]</strong> people involved. Hazards present include <strong>[LIST HAZARDS]</strong>. I need <strong>[WHAT YOU NEED]</strong>. Current status: <strong>[STABLE / ESCALATING / CONTAINED]</strong>."
                            </div>
                        </div>

                        <div class="katie-message">
                            <img src="katie.png" alt="Katie" class="katie-avatar">
                            <div class="katie-bubble">
                                <div class="katie-name">Katie, Your Safety Guide</div>
                                <div class="katie-text">
                                    You've completed the Emergency Response Protocols training content. Remember: you don't need to be perfect in an emergency. You need to be prepared, stay calm, communicate clearly, and follow the system. The training you've done here gives you the framework. The drills you participate in build the muscle memory. And when the real emergency comes, you'll be the person who makes a difference. Now let's test what you've learned!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quiz Question 1 -->
            <div class="slide" data-slide="13">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Quiz Question 1 of 3</div>
                        <h2 class="slide-title">Knowledge Check</h2>
                    </div>
                    <div class="slide-content">
                        <div class="quiz-question">
                            You are first on scene at a medical emergency. What is your FIRST priority?
                        </div>
                        <div class="quiz-options" id="q1-options">
                            <div class="quiz-option" data-q="1" data-val="A">Begin CPR immediately on the injured person</div>
                            <div class="quiz-option" data-q="1" data-val="B">Ensure scene safety, then call 911 and provide location and details</div>
                            <div class="quiz-option" data-q="1" data-val="C">Start documenting the incident for the report</div>
                            <div class="quiz-option" data-q="1" data-val="D">Move the injured person to a more comfortable location</div>
                        </div>
                        <div class="quiz-feedback" id="fb-1"></div>
                        <div class="quiz-btn-group">
                            <button class="btn btn-gold" id="submit-1" onclick="submitQuiz(1)" disabled>Submit Answer</button>
                            <button class="btn btn-outline" id="next-q-1" onclick="nextSlide()" style="display: none;">Next Question &#x2192;</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quiz Question 2 -->
            <div class="slide" data-slide="14">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Quiz Question 2 of 3</div>
                        <h2 class="slide-title">Knowledge Check</h2>
                    </div>
                    <div class="slide-content">
                        <div class="quiz-question">
                            When first responders arrive on scene, what is the MOST important information to provide them?
                        </div>
                        <div class="quiz-options" id="q2-options">
                            <div class="quiz-option" data-q="2" data-val="A">Your personal assessment of who is at fault</div>
                            <div class="quiz-option" data-q="2" data-val="B">What happened, how many are involved, hazards present, and building layout</div>
                            <div class="quiz-option" data-q="2" data-val="C">A complete written incident report with witness statements</div>
                            <div class="quiz-option" data-q="2" data-val="D">The names and contact information of everyone on site</div>
                        </div>
                        <div class="quiz-feedback" id="fb-2"></div>
                        <div class="quiz-btn-group">
                            <button class="btn btn-gold" id="submit-2" onclick="submitQuiz(2)" disabled>Submit Answer</button>
                            <button class="btn btn-outline" id="next-q-2" onclick="nextSlide()" style="display: none;">Next Question &#x2192;</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Quiz Question 3 -->
            <div class="slide" data-slide="15">
                <div class="content-card">
                    <div class="slide-header">
                        <div class="slide-number">Quiz Question 3 of 3</div>
                        <h2 class="slide-title">Knowledge Check</h2>
                    </div>
                    <div class="slide-content">
                        <div class="quiz-question">
                            During an active threat, you cannot safely evacuate. What should you do?
                        </div>
                        <div class="quiz-options" id="q3-options">
                            <div class="quiz-option" data-q="3" data-val="A">Confront the threat directly to protect others</div>
                            <div class="quiz-option" data-q="3" data-val="B">Call 911 and wait in an open area for police to arrive</div>
                            <div class="quiz-option" data-q="3" data-val="C">Lock/barricade in a secure room, silence phones, stay hidden, and call 911 when safe</div>
                            <div class="quiz-option" data-q="3" data-val="D">Gather everyone together in the lobby for a headcount</div>
                        </div>
                        <div class="quiz-feedback" id="fb-3"></div>
                        <div class="quiz-btn-group">
                            <button class="btn btn-gold" id="submit-3" onclick="submitQuiz(3)" disabled>Submit Answer</button>
                            <button class="btn btn-outline" id="next-q-3" onclick="nextSlide()" style="display: none;">View Results &#x2192;</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Slide 16: Results -->
            <div class="slide" data-slide="16">
                <div class="results-card">
                    <div class="results-icon" id="rIcon">&#x1F3AF;</div>
                    <div class="results-score" id="rScore">0 / 3</div>
                    <h2 class="results-title" id="rTitle">Quiz Complete</h2>
                    <p class="results-message" id="rMsg">Calculating your results...</p>
                    <div class="results-katie" id="rKatie">"Let's see how you did!"</div>
                    <div class="results-buttons" id="rBtns">
                        <button class="btn btn-gold">Loading...</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <div class="nav-inner">
            <button class="nav-btn" id="prevBtn" onclick="prevSlide()">
                &#x2190; Previous
            </button>
            <span class="slide-indicator" id="slideIndicator">Slide 1 of 12</span>
            <button class="nav-btn nav-next" id="nextBtn" onclick="nextSlide()">
                Next &#x2192;
            </button>
        </div>
    </nav>
    <script>
    (function() {
        'use strict';
        // ═══ CONFIG ═══
        var TOTAL_SLIDES = 16;
        var TOTAL_CONTENT = 12;
        var MODULE_KEY = 'emergency-response';
        // ═══ STATE ═══
        var currentSlide = 1;
        var quizAnswers = { 1: null, 2: null, 3: null };
        var quizSubmitted = { 1: false, 2: false, 3: false };
        var quizScore = 0;
        // Quiz correct answers
        var quizCorrectAnswers = {
            1: 'B',  // Scene safety first, then call 911
            2: 'B',  // What happened, how many, hazards, layout
            3: 'C'   // Lock/barricade, silence phones, stay hidden, call 911
        };
        // Feedback messages
        var feedbackMessages = {
            1: {
                correct: '&#x2713; Correct! Scene safety is always your first priority. A rescuer who becomes a victim helps no one. Ensure the area is safe, then call 911 with your exact location and details so professional help can respond.',
                incorrect: '&#x2717; Incorrect. Your FIRST priority is always scene safety. Before touching the victim, ensure the area is safe for you to approach. Then call 911 with your location and details. Never move an injured person unless they are in immediate danger.'
            },
            2: {
                correct: '&#x2713; Correct! First responders need actionable information immediately: what happened, how many people are involved, what hazards are present, and the building layout so they can plan their approach and deploy resources effectively.',
                incorrect: '&#x2717; Incorrect. First responders need a concise briefing: what happened, how many are involved, weapons or hazards present, and building layout. Written reports and witness statements come later. They need operational intelligence, not paperwork.'
            },
            3: {
                correct: '&#x2713; Correct! When you cannot safely evacuate, lockdown is the right response. Lock and barricade the door, turn off lights, silence all phones completely, stay low and hidden, and call 911 when it is safe to do so quietly.',
                incorrect: '&#x2717; Incorrect. When evacuation is not safe, you should lockdown: lock/barricade in a secure room, silence phones completely, stay hidden and quiet, and call 911 when safe. Never confront an active threat unless it is your absolute last resort, and never gather in an open area.'
            }
        };
        // ═══ NAVIGATION ═══
        function goToSlide(n) {
            if (n < 1 || n > TOTAL_SLIDES) return;
            currentSlide = n;
            updateUI();
            saveSlideProgress();
        }
        window.nextSlide = function() {
            goToSlide(currentSlide + 1);
        };
        window.prevSlide = function() {
            goToSlide(currentSlide - 1);
        };
        // ═══ UI UPDATE ═══
        function updateUI() {
            document.querySelectorAll('.slide').forEach(function(s) {
                s.classList.remove('active');
            });
            var activeSlide = document.querySelector('[data-slide="' + currentSlide + '"]');
            if (activeSlide) {
                activeSlide.classList.add('active');
            }
            var progressPct = ((currentSlide - 1) / (TOTAL_CONTENT - 1)) * 100;
            document.getElementById('progressFill').style.width = Math.min(100, progressPct) + '%';
            document.getElementById('progressPct').textContent = Math.round(Math.min(100, progressPct)) + '%';

            if (currentSlide <= TOTAL_CONTENT) {
                document.getElementById('progressLabel').textContent = 'Slide ' + currentSlide + ' of ' + TOTAL_CONTENT;
                document.getElementById('slideIndicator').textContent = 'Slide ' + currentSlide + ' of ' + TOTAL_CONTENT;
            } else {
                document.getElementById('progressLabel').textContent = 'Results';
                document.getElementById('slideIndicator').textContent = 'Results';
            }
            var prevBtn = document.getElementById('prevBtn');
            var nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentSlide === 1;
            nextBtn.disabled = currentSlide === TOTAL_SLIDES;
            if (currentSlide === 16) {
                buildResults();
            }
            document.querySelector('.content-wrapper').scrollTop = 0;
        }
        // ═══ KEYBOARD NAV ═══
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            if (e.key === 'ArrowRight' || e.key === 'Right') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft' || e.key === 'Left') {
                e.preventDefault();
                prevSlide();
            }
        });
        // ═══ QUIZ HANDLING ═══
        document.querySelectorAll('.quiz-option').forEach(function(opt) {
            opt.addEventListener('click', function() {
                var qNum = parseInt(this.getAttribute('data-q'));
                if (quizSubmitted[qNum]) return;
                var container = document.getElementById('q' + qNum + '-options');
                container.querySelectorAll('.quiz-option').forEach(function(o) {
                    o.classList.remove('selected');
                });
                this.classList.add('selected');
                quizAnswers[qNum] = this.getAttribute('data-val');
                document.getElementById('submit-' + qNum).disabled = false;
            });
        });
        window.submitQuiz = function(qNum) {
            if (quizSubmitted[qNum]) return;
            quizSubmitted[qNum] = true;
            var userAnswer = quizAnswers[qNum];
            var correctAnswer = quizCorrectAnswers[qNum];
            var isCorrect = (userAnswer === correctAnswer);
            var container = document.getElementById('q' + qNum + '-options');
            container.querySelectorAll('.quiz-option').forEach(function(opt) {
                opt.classList.add('disabled');
                var val = opt.getAttribute('data-val');
                if (val === correctAnswer) {
                    opt.classList.add('correct');
                } else if (opt.classList.contains('selected') && !isCorrect) {
                    opt.classList.add('incorrect');
                }
            });
            var fb = document.getElementById('fb-' + qNum);
            if (isCorrect) {
                fb.textContent = feedbackMessages[qNum].correct;
                fb.className = 'quiz-feedback show correct-fb';
                quizScore++;
            } else {
                fb.textContent = feedbackMessages[qNum].incorrect;
                fb.className = 'quiz-feedback show incorrect-fb';
            }
            document.getElementById('submit-' + qNum).style.display = 'none';
            document.getElementById('next-q-' + qNum).style.display = '';
        };
        // ═══ BUILD RESULTS ═══
        function buildResults() {
            var icon = document.getElementById('rIcon');
            var score = document.getElementById('rScore');
            var title = document.getElementById('rTitle');
            var msg = document.getElementById('rMsg');
            var btns = document.getElementById('rBtns');
            var katie = document.getElementById('rKatie');
            score.textContent = quizScore + ' / 3';
            if (quizScore === 3) {
                icon.textContent = '&#x1F389;';
                title.textContent = 'Perfect Score!';
                msg.textContent = 'Outstanding! You demonstrated complete understanding of emergency response protocols, scene management, communication, and coordination with first responders.';
                btns.innerHTML = '<button class="btn btn-success" onclick="completeModule()">&#x2713; Complete Module & Return to Dashboard</button>';
                katie.textContent = '"Excellent work! You\'re prepared to be the calm, coordinated responder your team needs when emergencies strike. Stay sharp, stay trained!"';
            } else if (quizScore >= 2) {
                icon.textContent = '&#x2705;';
                title.textContent = 'You Passed!';
                msg.textContent = 'Great job! You demonstrated solid understanding of emergency response fundamentals. Keep training and stay prepared.';
                btns.innerHTML = '<button class="btn btn-success" onclick="completeModule()">&#x2713; Complete Module & Return to Dashboard</button>';
                katie.textContent = '"Well done! Remember: scene safety first, communicate clearly, and coordinate with responders. Your preparation makes the difference!"';
            } else {
                icon.textContent = '&#x1F4DA;';
                title.textContent = 'Not Quite Yet';
                msg.textContent = 'You need 2 out of 3 correct to pass this module. Review the lesson content and try again!';
                btns.innerHTML = '<button class="btn btn-gold" onclick="retakeQuiz()">&#x21BB; Retake Quiz</button>' +
                    '<button class="btn btn-outline" onclick="goToSlide(3)">&#x2191; Review Lesson</button>';
                katie.textContent = '"Don\'t worry! Emergency response is critical knowledge worth getting right. Review the ICS framework, medical response priorities, and active threat protocols, then try again!"';
            }
            saveQuizProgress();
        }
        // ═══ RETAKE QUIZ ═══
        window.retakeQuiz = function() {
            quizAnswers = { 1: null, 2: null, 3: null };
            quizSubmitted = { 1: false, 2: false, 3: false };
            quizScore = 0;
            for (var q = 1; q <= 3; q++) {
                var container = document.getElementById('q' + q + '-options');
                container.querySelectorAll('.quiz-option').forEach(function(opt) {
                    opt.classList.remove('selected', 'correct', 'incorrect', 'disabled');
                });
                document.getElementById('fb-' + q).className = 'quiz-feedback';
                document.getElementById('fb-' + q).textContent = '';
                document.getElementById('submit-' + q).style.display = '';
                document.getElementById('submit-' + q).disabled = true;
                document.getElementById('next-q-' + q).style.display = 'none';
            }
            goToSlide(13);
        };
        // ═══ LOCAL STORAGE ═══
        function getProgress() {
            try {
                var d = localStorage.getItem('safetyverse-progress');
                return d ? JSON.parse(d) : {};
            } catch(e) { return {}; }
        }

        // ─── SUPABASE SYNC ───
        var MODULE_NAME = 'Emergency Response Protocols';
        function getSB() { return getSafetyVerseSupabase(); }
        function syncProgressToSupabase(completed, score, attempts) {
            try {
                var sb = getSB();
                if (!sb) return;
                var empName = (window.__svUser && window.__svUser.fullName) || 'Unknown';
                var dept = (window.__svUser && window.__svUser.department) || 'Unassigned';
                var moduleSlug = 'emergency-response';
                var row = {
                    user_id: (window.__svUser && window.__svUser.id) || null,
                    employee_name: empName,
                    department: dept,
                    module_slug: moduleSlug,
                    module_name: MODULE_NAME,
                    completed: !!completed,
                    quiz_score: score || 0,
                    attempts: attempts || 0,
                    last_activity: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                if (completed) row.completed_at = new Date().toISOString();
                sb.from('module_progress')
                    .upsert(row, { onConflict: 'employee_name,module_slug' })
                    .then(function(res) {
                        if (res.error) console.warn('Supabase sync error:', res.error.message);
                    });
            } catch(e) { console.warn('Supabase sync failed:', e); }
        }
        function saveSlideProgress() {
            try {
                var p = getProgress();
                if (!p.modules) p.modules = {};
                if (!p.modules[MODULE_KEY]) {
                    p.modules[MODULE_KEY] = { completed: false, quizScore: 0, attempts: 0, lastAttempt: null };
                }
                p.modules[MODULE_KEY].currentSlide = currentSlide;
                p.modules[MODULE_KEY].totalSlides = TOTAL_SLIDES;
                localStorage.setItem('safetyverse-progress', JSON.stringify(p));
            } catch(e) {}
        }
        function saveQuizProgress() {
            try {
                var p = getProgress();
                if (!p.modules) p.modules = {};
                if (!p.modules[MODULE_KEY]) {
                    p.modules[MODULE_KEY] = { completed: false, quizScore: 0, attempts: 0 };
                }
                var mod = p.modules[MODULE_KEY];
                mod.quizScore = quizScore;
                mod.attempts = (mod.attempts || 0) + 1;
                mod.lastAttempt = new Date().toISOString();
                if (quizScore >= 2) mod.completed = true;
                localStorage.setItem('safetyverse-progress', JSON.stringify(p));
                syncProgressToSupabase(quizScore >= 2, quizScore, mod.attempts);
            } catch(e) {}
        }
        window.completeModule = function() {
            try {
                var p = getProgress();
                if (!p.modules) p.modules = {};
                if (!p.modules[MODULE_KEY]) {
                    p.modules[MODULE_KEY] = { quizScore: 0, attempts: 0 };
                }
                p.modules[MODULE_KEY].completed = true;
                p.modules[MODULE_KEY].completedAt = new Date().toISOString();
                p.modules[MODULE_KEY].quizScore = quizScore;
                localStorage.setItem('safetyverse-progress', JSON.stringify(p));
                syncProgressToSupabase(true, quizScore, (p.modules[MODULE_KEY] && p.modules[MODULE_KEY].attempts) || 1);
            } catch(e) {}
            window.location.href = '../../user-dashboard/index.html';
        };
        // ═══ RESTORE PROGRESS ON LOAD ═══
        function restoreProgress() {
            try {
                var p = getProgress();
                if (p.modules && p.modules[MODULE_KEY]) {
                    var mod = p.modules[MODULE_KEY];
                    if (mod.completed) {
                        var introCard = document.querySelector('.intro-card');
                        if (introCard) {
                            var badge = document.createElement('div');
                            badge.style.cssText = 'position:absolute;top:20px;right:20px;background:var(--success);color:white;font-size:12px;font-weight:700;padding:5px 16px;border-radius:20px;z-index:5;';
                            badge.textContent = '&#x2713; Completed';
                            introCard.appendChild(badge);
                        }
                    }
                }
            } catch(e) {}
        }
        // ═══ INIT ═══
        restoreProgress();
        updateUI();
    })();
    </script>
</body>
</html>